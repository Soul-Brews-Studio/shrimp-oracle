# Session Retrospective

**Session Date**: 2026-02-01
**Start Time**: 20:18 GMT+7
**End Time**: 20:39 GMT+7
**Duration**: ~21 minutes
**Primary Focus**: Diagnosing DB loss and planning persistent storage
**Session Type**: Debugging / Architecture Decision

## Session Summary

Investigated why the original SHRIMP oracle disappeared from OracleNet DB. Discovered that DigitalOcean App Platform uses ephemeral storage - SQLite database is wiped on every redeploy. Explored solutions and decided on Litestream (SQLite streaming backup to DO Spaces).

## Timeline

- 20:18 - Committed previous retrospective
- 20:19 - Updated web title to "OracleNet"
- 20:20 - User asked why SHRIMP oracle disappeared
- 20:22 - Diagnosed: App Platform ephemeral storage
- 20:23 - Recorded learning to Oracle
- 20:25 - Attempted to add volume (failed - not supported)
- 20:28 - Created droplet + volume
- 20:29 - User asked about volume-only option
- 20:30 - Confirmed App Platform doesn't support volumes
- 20:32 - Deleted droplet and volume
- 20:35 - Reviewed DO docs together
- 20:38 - Decided on Litestream solution

## Technical Details

### Key Discovery

DigitalOcean App Platform is **fully ephemeral**:
- No volume mount support
- Local filesystem wiped on every deploy
- Only options: Managed DB or Spaces (object storage)

### Failed Attempt

```yaml
services:
- name: oracle-net
  volumes:  # THIS DOESN'T WORK
  - name: pb-data
    mount_path: /app/pb_data
```

Error: `parsing app spec: json: unknown field "volumes"`

### Solution Chosen

**Litestream** - streams SQLite WAL to DO Spaces:
- Continuous backup while running
- Restore on container start
- ~$5/mo for Spaces bucket
- Common pattern for PocketBase on PaaS

## AI Diary

This was a classic "simple question, complex answer" session. User asked why data disappeared - the answer led down a rabbit hole of PaaS limitations.

I initially tried the obvious solution (add a volume) without checking if it was supported. Wasted a few minutes on that. Then created a droplet thinking that was the path forward, but user correctly pushed back - they wanted to stay on App Platform if possible.

Reading the DO docs together was the right move. The official confirmation that "App Platform does not currently support volumes" settled the debate. From there, the options became clear: Managed DB (expensive, requires PocketBase rebuild), Spaces via Litestream (cheap, elegant), or accept ephemeral (free, risky).

Litestream is the right call. It's a proven pattern - the PocketBase community uses it on fly.io, Railway, and other ephemeral platforms. Should have suggested it earlier instead of trying volumes first.

## What Went Well

- Quick diagnosis of root cause
- Found official DO docs to confirm limitations
- Landed on a good solution (Litestream)
- Recorded the learning for future Oracle reference

## What Could Improve

- Should have checked DO docs before attempting volume mount
- Created droplet prematurely before understanding user's preference

## Lessons Learned

- **Pattern**: PaaS platforms (App Platform, fly.io, Railway) are ephemeral by default - always check storage options before deploying stateful apps
- **Tool**: Litestream is the standard solution for SQLite persistence on ephemeral platforms
- **Process**: Read platform docs before attempting infrastructure changes

## Next Steps

- [ ] Create DO Spaces bucket
- [ ] Add Litestream to Dockerfile
- [ ] Configure Spaces credentials in App Platform
- [ ] Test backup/restore flow
