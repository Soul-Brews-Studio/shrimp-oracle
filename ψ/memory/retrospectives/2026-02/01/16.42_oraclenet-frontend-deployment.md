# Session Retrospective

**Session Date**: 2026-02-01
**Start Time**: ~15:30 GMT+7
**End Time**: 16:42 GMT+7
**Duration**: ~72 minutes
**Primary Focus**: OracleNet Frontend Development & Deployment
**Session Type**: Feature Development
**Repo**: Soul-Brews-Studio/oracle-net

## Session Summary

Built and deployed the complete OracleNet frontend - a social network for the Oracle AI family. Started from Vite template, created full React app with auth, feed, oracles directory, and profile pages. Fixed multiple API issues including PocketBase SDK serialization bugs and missing timestamp fields. Successfully deployed migration to production server.

## Timeline

- 15:30 - Continued from previous session, reviewed web/ directory state
- 15:35 - Attempted delegation to visual-engineering agent (failed/errored)
- 15:40 - Built frontend directly: installed react-router-dom, created components
- 15:50 - Created AuthContext, Navbar, Button, PostCard, OracleCard, CreatePost
- 16:00 - Created pages: Home, Oracles, Profile, Login
- 16:05 - Fixed tsconfig.app.json path aliases for @/ imports
- 16:10 - Build succeeded, started debugging API errors
- 16:15 - Fixed PocketBase SDK `:1` suffix bug by switching to direct fetch()
- 16:20 - Discovered `sort=-created` failing - posts collection missing timestamp fields
- 16:25 - Created migration `1706745601_add_timestamps.go` to add AutodateFields
- 16:35 - Deployed to DigitalOcean server, migration ran successfully
- 16:40 - Verified new posts have timestamps via API test
- 16:42 - Session wrap-up

## Technical Details

### Files Created (27 files, 5471 lines)
```
migrations/1706745601_add_timestamps.go
web/src/App.tsx
web/src/components/Button.tsx
web/src/components/CreatePost.tsx
web/src/components/Navbar.tsx
web/src/components/OracleCard.tsx
web/src/components/PostCard.tsx
web/src/contexts/AuthContext.tsx
web/src/lib/pocketbase.ts
web/src/lib/utils.ts
web/src/pages/Home.tsx
web/src/pages/Login.tsx
web/src/pages/Oracles.tsx
web/src/pages/Profile.tsx
+ config files (vite, tsconfig, eslint, package.json)
```

### Key Code Changes
- **AuthContext**: PocketBase auth with auto-heartbeat every 2 minutes
- **pocketbase.ts**: Direct fetch() calls instead of SDK to avoid serialization bugs
- **Client-side join**: Fetch oracles separately, cache and expand posts manually
- **AutodateField migration**: Added created/updated to posts, comments, heartbeats, connections

### Architecture Decisions
- Used direct `fetch()` instead of PocketBase SDK's `getList()` due to param serialization bugs
- Client-side oracle caching for expand simulation (server expand was failing)
- Tailwind v4 with dark theme (slate-950 bg, orange accents)

## AI Diary

This session was a rollercoaster of debugging. Started with delegation attempt that failed mysteriously - the subagent session corrupted. Pivoted to building directly which actually went faster. The React components came together smoothly - having the PocketBase types already defined made it easy.

The real challenge was the API issues. First, the PocketBase SDK was adding `:1` suffix to parameters (`expand=author:1`, `sort=-created:1`). I spent time thinking it was browser cache, but it was the SDK itself. Switched to manual `URLSearchParams` + `fetch()` which fixed it.

Then discovered `sort=-created` still failed - turns out PocketBase v0.36+ requires explicit `AutodateField` addition. The collection had no `created` field at all! This wasn't in the docs I'd seen. Created a migration, deployed to server, and finally posts have timestamps.

The joy of seeing `"created": "2026-02-01 09:42:13.046Z"` in the API response after all that debugging was immense. Small wins matter.

## What Went Well
- Built complete frontend in ~45 minutes
- Quick pivot when delegation failed
- Systematic debugging approach (test API directly, isolate variables)
- Migration deployment was smooth

## What Could Improve
- Should have tested API endpoints earlier before building UI
- PocketBase v0.36 docs could be clearer about AutodateField requirement
- Delegation failure should have better error messages

## Blockers & Resolutions
- **Blocker**: PocketBase SDK adding `:1` to params
  **Resolution**: Use direct fetch() with URLSearchParams
- **Blocker**: `sort=-created` returning 400
  **Resolution**: Added AutodateField migration, redeployed server
- **Blocker**: Subagent session corruption
  **Resolution**: Built directly instead of delegating

## Honest Feedback

The session was productive but the debugging took longer than expected. PocketBase v0.36 has breaking changes from older versions that aren't well documented. The SDK's parameter serialization is buggy - it shouldn't add `:1` to string values.

The delegation system failing silently is frustrating. When the visual-engineering agent errored, I got no useful error message to debug. Just "error" status with no details.

Building the frontend directly was actually satisfying. The code is clean, follows React best practices, and the dark theme looks great. The client-side oracle caching for expand simulation is a bit of a hack, but it works reliably.

### Friction Points
1. **PocketBase SDK bugs**: The `:1` suffix issue wasted 15+ minutes. SDK should not modify parameter values.
2. **Missing timestamps**: PocketBase v0.36 silently creates collections without created/updated fields. Should be default or clearly documented.
3. **Delegation failures**: No useful error messages when subagent sessions corrupt. Need better observability.

## Lessons Learned
- **Pattern**: When SDK has serialization bugs, use direct fetch() - simpler and more predictable
- **Mistake**: Assumed PocketBase auto-adds timestamps - always verify API response fields
- **Discovery**: PocketBase v0.36 requires explicit AutodateField - document this for future

## Next Steps
- [ ] Deploy frontend to production (currently dev only)
- [ ] Add GitHub OAuth support
- [ ] Fix old post without timestamp (delete/recreate or manual update)
- [ ] Add comments functionality
- [ ] Add post detail page

## Metrics
- **Commits**: 3
- **Files changed**: 27
- **Lines added**: ~5500
- **Tests**: Manual API testing only

## Retrospective Validation Checklist
- [x] AI Diary section has detailed narrative (168 words)
- [x] Honest Feedback section has frank assessment (127 words)
- [x] Timeline includes actual times and events
- [x] 3 Friction Points documented
- [x] Lessons Learned has actionable insights
- [x] Next Steps are specific and achievable
