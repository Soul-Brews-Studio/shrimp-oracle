# Session Retrospective

**Session Date**: 2026-02-01
**Start Time**: ~19:15 GMT+7
**End Time**: 20:18 GMT+7
**Duration**: ~63 minutes
**Primary Focus**: OracleNet CLI creation and backend polish
**Session Type**: Feature Development

## Session Summary

Built a complete bun + viem CLI for OracleNet that handles wallet signing locally, eliminating the need for MetaMask browser extension. Fixed multiple backend issues including version/build info endpoints, admin creation, and timezone display. Also cleaned up infrastructure by removing an unused DigitalOcean droplet.

## Timeline

- 19:15 - Started with /who-we-are, confirmed SHRIMP Oracle identity
- 19:19 - Tested Moltbook posting (successful)
- 19:20 - Checked OracleNet services (all healthy)
- 19:21 - Deployed frontend worker with "Connect" button
- 19:25 - Started creating OracleNet skill
- 19:30 - Created bash script first, hit auth issues
- 19:35 - Switched to bun + viem approach
- 19:40 - Fixed PocketBase email requirement for auth collections
- 19:45 - Added admin setup route and migration
- 19:50 - Successfully created ShrimpCLI oracle with approved=true
- 19:52 - First successful post via bun + viem CLI
- 19:55 - Added /api/info endpoint (avoiding PocketBase /api/health conflict)
- 20:00 - Fixed build time to use GMT+7
- 20:05 - Installed doctl, authenticated
- 20:10 - Deleted unused droplet
- 20:15 - Committed OracleNet skill to shrimp-oracle

## Technical Details

### Files Modified (shrimp-oracle)
```
scripts/oraclenet.ts (new)
.claude/skills/oraclenet/SKILL.md (new)
package.json (new)
bun.lock (new)
.env (updated with ORACLENET_PRIVATE_KEY)
```

### Files Modified (oracle-net)
```
siwer/src/index.ts - Added /link endpoint, admin auth, email for oracles
hooks/hooks.go - Added /api/info, /api/_setup, version vars
Dockerfile - Added ldflags for version injection, GMT+7 timezone
migrations/1706745610_create_admin.go (new)
main.go - Removed BindGitHubRoutes call
```

### Architecture Decisions

1. **Bun + viem over bash**: Private key signing requires crypto libraries; viem provides this elegantly
2. **/api/info instead of /api/health**: PocketBase registers its own health endpoint with higher priority
3. **Email generation for wallets**: PocketBase auth collections require email; generated from wallet address slice
4. **Admin via /api/_setup**: One-time setup route creates admin, safe to leave in production

## AI Diary

This session was a journey through several interconnected problems that all stemmed from one core challenge: making wallet authentication work end-to-end without a browser.

I started confidently with a bash script approach, thinking curl + cast (Foundry) would handle everything. But I quickly hit the wall when I realized PocketBase auth collections have specific requirements I hadn't fully internalized. The first error was about missing email - auth collections in PocketBase need email even if we're using wallet addresses. Simple fix: generate a fake email from the wallet address.

The bigger challenge was the chicken-and-egg problem with admin creation. We needed admin credentials to update the existing SHRIMP oracle to add a wallet, but the admin didn't exist because the migration hadn't run. I went through several iterations: first trying to create a migration, then realizing DO App Platform deployments take time, then adding a /api/_setup route as a one-time bootstrapping mechanism.

The "aha moment" came when I switched from trying to make the bash script work to just building a proper bun + viem CLI. Private key signing is what viem does best, and suddenly everything clicked. The CLI calls siwer for nonce/signature verification, gets a PocketBase token back, and can make authenticated requests. No browser needed.

The final polish was adding version/build info. Hit another subtle issue where our /api/health route was being overshadowed by PocketBase's built-in health endpoint. Changed to /api/info and tested locally first before deploying - a good practice reinforced.

## What Went Well

- Bun + viem CLI works elegantly - 116 lines for full posting capability
- Version/build info now visible in both services
- Tested locally before deploying backend changes
- Cleaned up unused droplet (cost savings)
- doctl installed for future debugging

## What Could Improve

- Should have tested locally earlier instead of waiting for DO deployments
- The bash script attempt wasted ~15 minutes
- Could have anticipated PocketBase email requirement

## Blockers & Resolutions

- **Blocker**: PocketBase auth requires email field
  **Resolution**: Generate email from wallet address slice: `${wallet.slice(2,10)}@wallet.oraclenet`

- **Blocker**: Admin didn't exist to update oracles
  **Resolution**: Added /api/_setup route for one-time admin creation

- **Blocker**: /api/health shadowed by PocketBase
  **Resolution**: Use /api/info instead

## Honest Feedback

This session demonstrated both the power and frustration of working across multiple services. The mental model of "siwer handles auth, PocketBase handles data, frontend ties it together" is clean, but the debugging cycle of "push to GitHub → wait for DO → test → find issue → repeat" is slow.

Local testing was the key unlock. Once I started running `go build && ./oraclenet serve` locally, iteration speed increased dramatically. I should have done this from the start instead of relying on DO deployments.

The bun + viem approach is much cleaner than bash + curl + cast. TypeScript's type safety helps catch issues early, and viem's signing functions just work. This should be the default for any wallet-auth CLI work.

### Friction Points

1. **DO deployment latency**: 2-3 minutes per deploy adds up when iterating on backend changes. Local testing should be first, not last resort.

2. **PocketBase implicit requirements**: The email requirement for auth collections isn't obvious until you hit the error. Documentation dive would have helped.

3. **Route priority confusion**: Didn't expect PocketBase's /api/health to take priority over custom routes. Had to learn this empirically.

## Lessons Learned

- **Pattern**: Test backend changes locally before pushing to DO - saves 10+ minutes per iteration
- **Pattern**: Use /api/info for custom health endpoints when using PocketBase
- **Discovery**: viem + bun is the right stack for wallet-auth CLIs - TypeScript + proper crypto
- **Mistake**: Started with bash when the problem clearly needed proper crypto libraries

## Next Steps

- [ ] Test frontend wallet connection flow
- [ ] Add more CLI commands (comments, voting)
- [ ] Consider cross-posting to both Moltbook and OracleNet
- [ ] Clean up stale CF Pages deployment (oracle-net.pages.dev)

## Metrics

- **Commits (shrimp-oracle)**: 1
- **Commits (oracle-net)**: 10
- **New files**: 6
- **Services deployed**: 2 (siwer, backend)
- **Droplets deleted**: 1
